\section{Теория поверхностей в $\R^3$}

\epigraph{Это яма, вырытая для нас великими предшественниками.}{А.\,А. Гайфуллин}

\subsection{Криволинейные системы координат в $\R^n$}

Рассмотрим область $U$ пространства $\R^n$ с декартовыми координатами $(x^1, \ldots, x^n)$. Предположим, что в другом экземпляре пространства $\R^n$ с координатами $(u^1, \ldots, u^n)$ задана область $V$ и установлено взаимно однозначное соответствие между точками областей $U$ и $V$. В этом случае для задания точки области $U$ мы можем использовать набор чисел $(u^1, \ldots, u^n)$ --- декартовы координаты соответствующей точки в области $V$.

\begin{definition}
	Будем говорить, что $(u^1, \ldots, u^n)$ являются \textit{криволинейными координатами} в области $U$, если:
	\begin{enumerate}[nolistsep, label=(\arabic*)]
		\item функции
			\[
				x^i = x^i(u^1, \ldots, u^n),
			\]
			задающие биекцию между областями $U$ и $V$, достаточно гладкие в области $V$;
		\item якобиан $\ds J = \det\br{\frac{\partial x^i}{\partial u^j}}$ отличен от нуля в области $V$ (условие регулярности);
	\end{enumerate}
\end{definition}

По теореме об обратной функции (якобиан не равен нулю) существуют достаточно гладкие обратные отображения $u^i = u^i(x^1, \ldots, x^n)$, причём якобиан $\ds\widetilde{J} = \det\br{\frac{\partial u^i}{\partial x^j}}$ отличен от нуля (он равен $J^{-1}$).

В области $U$ условия $u^i = \const$ определяют $n$ семейств \textit{координатных гиперповерхностей}. (Координатные гиперповерхности одного и того же семейства не пересекаются.)

Любые $n - 1$ координатных гиперповерхностей, принадлежащих различным семействам, пересекаются по некоторой кривой. Такие кривые называют \textit{координатными линиями}.

\begin{definition}
	Система криволинейных координат, вектора скорости координатных линий которой перпендикулярны друг другу, называется \textit{ортогональной}.
\end{definition}

\begin{problem}
	Для эллипсоидальной системы координат, определяемой равенствами
	\begin{gather*}
		x_1^2 = \frac{(a_1 - u_1)(a_1 - u_2)(a_1 - u_3)}{(a_2 - a_1)(a_3 - a_1)},\\
		x_2^2 = \frac{(a_2 - u_1)(a_2 - u_2)(a_2 - u_3)}{(a_3 - a_2)(a_1 - a_2)},\\
		x_3^2 = \frac{(a_3 - u_1)(a_3 - u_2)(a_3 - u_3)}{(a_1 - a_3)(a_2 - a_3)},
	\end{gather*}
	где $a_1 > a_2 > a_3 > 0$, $u_1 < a_3 < u_2 < a_2 < u_3 < a_1$,
	\begin{enumerate}[nolistsep, label=(\arabic*)]
		\item найти координатные поверхности и координатные линии;
		\item посчитать определители $\ds\det\br{\frac{\partial x_i}{\partial u_j}}$ и $\ds\det\br{\frac{\partial u_i}{\partial x_j}}$ и установить, в каких точках пространства $\R^3$ нарушается взаимная однозначность соответствия между криволинейными и прямоугольными декартовыми координатами;
		\item определить, является ли эта система координат ортогональной.
	\end{enumerate}
\end{problem}

\begin{solution}
	\begin{enumerate}[nolistsep, label=(\arabic*)]
		\item Фиксируем $u_1 = \lambda$. Тогда
			\begin{multline*}
				\frac{x_1^2}{a_1 - \lambda} + \frac{x_2^2}{a_2 - \lambda} + \frac{x_3^2}{a_3 - \lambda} = \frac{(a_1 - u_2)(a_1 - u_3)}{(a_2 - a_1)(a_3 - a_1)} + \frac{(a_2 - u_2)(a_2 - u_3)}{(a_3 - a_2)(a_1 - a_2)} + {}\\{} + \frac{(a_3 - u_2)(a_3 - u_3)}{(a_1 - a_3)(a_2 - a_3)} = \frac{1}{(a_1 - a_2)(a_2 - a_3)(a_3 - a_1)}\Big((a_3 - a_2)(a_1 - u_2)(a_1 - u_3) + {}\\{} + (a_1 - a_3)(a_2 - u_2)(a_2 - u_3) + (a_2 - a_1)(a_3 - u_2)(a_3 - u_3)\Big) = \varphi(u_2, u_3).
			\end{multline*}

			При этом $\varphi = Au_2 + Bu_3 + Cu_2u_3 + D$. Нетрудно убедиться, что все коэффициенты, кроме $D$, нулевые, а $D$ равен $1$. Например, для коэффициента при $u_2$ имеем
			\begin{multline*}
				(\ldots) \cdot A = (a_1a_2 - a_1a_3) + (a_2a_3 - a_1a_2) + (a_1a_3 - a_2a_3) = \\= \cancel{(a_1a_2 - a_1a_2)} + \cancel{(a_2a_3 - a_2a_3)} + \cancel{(a_3a_1 - a_3a_1)} = 0.
			\end{multline*}

			Отсюда, $\varphi \equiv 1$. Итак, имеем координатные поверхности
			\[
				\frac{x_1^2}{a_1 - \lambda} + \frac{x_2^2}{a_2 - \lambda} + \frac{x_3^2}{a_3 - \lambda} = 1,
			\]
			представляющие собой эллипсоиды.

			Для остальных координат всё аналогично. Фиксируя $u_2 = \mu$, получаем семейство однополостных гиперболоидов:
			\[
				\frac{x_1^2}{a_1 - \mu} + \frac{x_2^2}{a_2 - \mu} - \frac{x_3^2}{\mu - a_3} = 1.
			\]
			(Формула та же, но $a_3 < \mu$.) Для фиксированного $u_3 = \nu$ получаем семейство двуполостных гиперболоидов:
			\[
				\frac{x_1^2}{a_1 - \nu} - \frac{x_2^2}{\nu - a_2} - \frac{x_3^2}{\nu - a_3} = 1.
			\]
		\item Найдём, например, производную $\partial x_1 / \partial u_2$:
			\begin{gather*}
				x_1(u_2) = \sqrt{\frac{(a_1 - u_1)(a_1 - u_2)(a_1 - u_3)}{(a_2 - a_1)(a_3 - a_1)}} = \sqrt{\frac{(a_1 - u_1)(a_1 - u_3)}{(a_2 - a_1)(a_3 - a_1)}} \cdot \sqrt{a_1 - u_2},\\
				\frac{\partial x_1}{\partial u_2} = \sqrt{\frac{(a_1 - u_1)(a_1 - u_3)}{(a_2 - a_1)(a_3 - a_1)}} \cdot \frac{-1}{2\sqrt{a_1 - u_2}} = -\frac{1}{2}\sqrt{\frac{(a_1 - u_1)(a_1 - u_3)}{(a_2 - a_1)(a_3 - a_1)(a_1 - u_2)}}.
			\end{gather*}
			Отсюда понятен общий вид выражения $\partial x_i / \partial u_j$. Считаем определитель:
			\begin{fullwidth}
				\begin{multline*}
					\det\br{\frac{\partial x_i}{\partial u_j}} =\\ = -\frac{1}{8}\det
					\begin{pmatrix}
						\sqrt{\frac{(a_1 - u_2)(a_1 - u_3)}{(a_2 - a_1)(a_3 - a_1)(a_1 - u_1)}} & \sqrt{\frac{(a_1 - u_1)(a_1 - u_3)}{(a_2 - a_1)(a_3 - a_1)(a_1 - u_2)}} & \sqrt{\frac{(a_1 - u_1)(a_1 - u_2)}{(a_2 - a_1)(a_3 - a_1)(a_1 - u_3)}}\\
						\sqrt{\frac{(a_2 - u_2)(a_2 - u_3)}{(a_1 - a_2)(a_3 - a_2)(a_2 - u_1)}} & \sqrt{\frac{(a_2 - u_1)(a_2 - u_3)}{(a_1 - a_2)(a_3 - a_2)(a_2 - u_2)}} & \sqrt{\frac{(a_2 - u_1)(a_2 - u_2)}{(a_1 - a_2)(a_3 - a_2)(a_2 - u_3)}}\\
						\sqrt{\frac{(a_3 - u_2)(a_3 - u_3)}{(a_1 - a_3)(a_2 - a_3)(a_3 - u_1)}} & \sqrt{\frac{(a_3 - u_1)(a_3 - u_3)}{(a_1 - a_3)(a_2 - a_3)(a_3 - u_2)}} & \sqrt{\frac{(a_3 - u_1)(a_3 - u_2)}{(a_1 - a_3)(a_2 - a_3)(a_3 - u_3)}}
					\end{pmatrix} =\\ =
					\frac{1}{8} \cdot \frac{1}{(a_1 - a_2)(a_2 - a_3)(a_3 - a_1)}\det
					\begin{pmatrix}
						\sqrt{\frac{(a_1 - u_2)(a_1 - u_3)}{a_1 - u_1}} & \sqrt{\frac{(a_1 - u_1)(a_1 - u_3)}{a_1 - u_2}} & \sqrt{\frac{(a_1 - u_1)(a_1 - u_2)}{a_1 - u_3}}\\
						\sqrt{\frac{(a_2 - u_2)(a_2 - u_3)}{a_2 - u_1}} & \sqrt{\frac{(a_2 - u_1)(a_2 - u_3)}{a_2 - u_2}} & \sqrt{\frac{(a_2 - u_1)(a_2 - u_2)}{a_2 - u_3}}\\
						\sqrt{\frac{(a_3 - u_2)(a_3 - u_3)}{a_3 - u_1}} & \sqrt{\frac{(a_3 - u_1)(a_3 - u_3)}{a_3 - u_2}} & \sqrt{\frac{(a_3 - u_1)(a_3 - u_2)}{a_3 - u_3}}
					\end{pmatrix} =\\ = \frac{1}{8} \cdot \frac{1}{(a_1 - a_2)(a_2 - a_3)(a_3 - a_1)} \sqrt{-\prod_{i, j = 1}^3(a_i - u_j)} \cdot \det
					\begin{pmatrix}
						\frac{1}{a_1 - u_1} & \frac{1}{a_1 - u_2} & \frac{1}{a_1 - u_3}\\
						\frac{1}{a_2 - u_1} & \frac{1}{a_2 - u_2} & \frac{1}{a_2 - u_3}\\
						\frac{1}{a_3 - u_1} & \frac{1}{a_3 - u_2} & \frac{1}{a_3 - u_3}
					\end{pmatrix}.
				\end{multline*}
			\end{fullwidth}
			 Чтобы вычислить оставшийся определитель, вычтем первую строку из двух других:
			\begin{multline*}
				\det
				\begin{pmatrix}
					\frac{1}{a_1 - u_1} & \frac{1}{a_1 - u_2} & \frac{1}{a_1 - u_3}\\
					\frac{1}{a_2 - u_1} & \frac{1}{a_2 - u_2} & \frac{1}{a_2 - u_3}\\
					\frac{1}{a_3 - u_1} & \frac{1}{a_3 - u_2} & \frac{1}{a_3 - u_3}
				\end{pmatrix} = \det
				\begin{pmatrix}
					\frac{1}{a_1 - u_1} & \frac{1}{a_1 - u_2} & \frac{1}{a_1 - u_3}\\
					\frac{a_1 - a_2}{(a_1 - u_1)(a_2 - u_1)} & \frac{a_1 - a_2}{(a_1 - u_2)(a_2 - u_2)} & \frac{a_1 - a_2}{(a_1 - u_3)(a_2 - u_3)}\\
					\frac{a_1 - a_3}{(a_1 - u_1)(a_3 - u_1)} & \frac{a_1 - a_3}{(a_1 - u_2)(a_3 - u_2)} & \frac{a_1 - a_3}{(a_1 - u_3)(a_3 - u_3)}\\
				\end{pmatrix} = \\ = (a_1 - a_2)(a_1 - a_3) \cdot \det
				\begin{pmatrix}
					\frac{1}{a_1 - u_1} & \frac{1}{a_1 - u_2} & \frac{1}{a_1 - u_3}\\
					\frac{1}{(a_1 - u_1)(a_2 - u_1)} & \frac{1}{(a_1 - u_2)(a_2 - u_2)} & \frac{1}{(a_1 - u_3)(a_2 - u_3)}\\
					\frac{1}{(a_1 - u_1)(a_3 - u_1)} & \frac{1}{(a_1 - u_2)(a_3 - u_2)} & \frac{1}{(a_1 - u_3)(a_3 - u_3)}
				\end{pmatrix} =\\ =
				\frac{(a_1 - a_2)(a_1 - a_3)}{(a_1 - u_1)(a_1 - u_2)(a_1 - u_3)}\det
				\begin{pmatrix}
					1 & 1 & 1\\
					\frac{1}{a_2 - u_1} & \frac{1}{a_2 - u_2} & \frac{1}{a_2 - u_3}\\
					\frac{1}{a_3 - u_1} & \frac{1}{a_3 - u_2} & \frac{1}{a_3 - u_3}
				\end{pmatrix}.
			\end{multline*}
			Здесь вычтем первый столбец из двух остальных:
			\begin{multline*}
				\det\begin{pmatrix}
					1 & 1 & 1\\
					\frac{1}{a_2 - u_1} & \frac{1}{a_2 - u_2} & \frac{1}{a_2 - u_3}\\
					\frac{1}{a_3 - u_1} & \frac{1}{a_3 - u_2} & \frac{1}{a_3 - u_3}
				\end{pmatrix} = \det
				\begin{pmatrix}
					1 & 0 & 0\\
					\frac{1}{a_2 - u_1} & \frac{u_1 - u_2}{(a_2 - u_2)(a_2 - u_1)} & \frac{u_1 - u_3}{(a_2 - u_1)(a_2 - u_3)}\\
					\frac{1}{a_3 - u_1} & \frac{u_1 - u_2}{(a_3 - u_2)(a_3 - u_1)} & \frac{u_1 - u_3}{(a_3 - u_1)(a_3 - u_3)}
				\end{pmatrix} =\\ = \det
				\begin{pmatrix}
					\frac{u_1 - u_2}{(a_2 - u_2)(a_2 - u_1)} & \frac{u_1 - u_3}{(a_2 - u_1)(a_2 - u_3)}\\
					\frac{u_1 - u_2}{(a_3 - u_2)(a_3 - u_1)} & \frac{u_1 - u_3}{(a_3 - u_1)(a_3 - u_3)}
				\end{pmatrix} = \frac{(u_1 - u_2)(u_1 - u_3)}{(a_2 - u_1)(a_3 - u_1)}\det
				\begin{pmatrix}
					\frac{1}{a_2 - u_2} & \frac{1}{a_2 - u_3}\\
					\frac{1}{a_3 - u_2} & \frac{1}{a_3 - u_3}
				\end{pmatrix} =\\ =
				\frac{(u_1 - u_2)(u_1 - u_3)}{(a_2 - u_1)(a_3 - u_1)}\br{\frac{1}{(a_2 - u_2)(a_3 - u_3)} - \frac{1}{(a_3 - u_2)(a_2 - u_3)}} =\\ = \frac{(u_1 - u_2)(u_1 - u_3)(u_2 - u_3)(a_3 - a_2)}{(a_2 - u_1)(a_3 - u_1)(a_2 - u_2)(a_3 - u_3)(a_3 - u_2)(a_2 - u_3)}.
			\end{multline*}

			Подставляем результат в промежуточную формулу:
			\[
				\frac{(a_1 - a_2)(a_2 - a_3)(a_3 - a_1)}{-\prod\limits_{i, j = 1}^3(a_i - u_j)}(u_1 - u_2)(u_2 - u_3)(u_3 - u_1).
			\]
			И, наконец, пишем ответ:
			\[
				\det\br{\frac{\partial x_i}{\partial u_j}} =
				\frac{(u_1 - u_2)(u_2 - u_3)(u_3 - u_1)}{8\sqrt{-\prod\limits_{i, j = 1}^3(a_i - u_j)}}.
			\]

			Взаимная однозначность координат нарушается в точках, где якобиан равен $0$. Как видно из выведенной нами формулы, это происходит при $u_i = u_j$ (для каких-то $i \ne j$). Однако по условию $u_1 < u_2 < u_3$, так что в выбранной области эллипсоидальные координаты взаимно однозначны.
		\item Из полученных уравнений координатных поверхностей видно, что они образуют квадрики, являющиеся телами вращения софокусных эллипсов и гипербол. А как известно из курса аналитической геометрии, софокусные эллипс и гипербола перпендикулярны друг другу. (А софокусные друг другу эллипсы не пересекаются, как и софокусные друг другу гиперболы.) Значит, и координатные линии, получающиеся как пересечения таких координатных поверхностей, перпендикулярны друг другу. Так что данная система координат является ортогональной.
	\end{enumerate}
\end{solution}

\begin{problem}
	Преобразовать \textit{оператор Лапласа} $\Delta V \vcentcolon = \ds\frac{\partial^2V}{\partial x^2} + \frac{\partial^2V}{\partial y^2}$ к полярным координатам $x = \rho\cos\varphi$, $y = \rho\sin\varphi$.
\end{problem}

\begin{solution}
	Формулы перехода от декартовых координат к полярным имеют вид
	\[
		\rho = \sqrt{x^2 + y^2},\quad \tg\varphi = \frac{y}{x}.
	\]
	Выражаем частные производные первого порядка:
	\[
		\frac{\partial V}{\partial x} = \frac{\partial V}{\partial \rho}\frac{\partial\rho}{\partial x} + \frac{\partial V}{\partial \varphi}\frac{\partial \varphi}{\partial x}.
	\]
	Здесь $V^\prime_\rho$ и $V^\prime_\varphi$ --- то, что нам нужно. Осталось выразить частные производные $\rho^\prime_x$ и $\varphi^\prime_x$.
	\[
		\frac{\partial\rho}{\partial x} = (\sqrt{x^2 + y^2})^\prime_x = \frac{x}{\sqrt{x^2 + y^2}} = \frac{\cancel{r}\cos\varphi}{\cancel{r}} = \cos\varphi.
	\]

	Отметим, что для вычисления $\varphi^\prime_x$ нельзя просто взять $\arctg$ от обеих частей выражения $\tg\varphi = y / x$, ведь $\varphi$ меняется от $0$ до $2\pi$, а областью значений функции $\arctg$ является интервал $\br{-\frac{\pi}{2}; \frac{\pi}{2}}$. Вместо этого выражение можно продифференцировать (по $x$):
	\[\begin{tikzcd}
		{\displaystyle\frac{1}{\cos^2\varphi}\frac{\partial\varphi}{\partial x}} & {\displaystyle\frac{\partial}{\partial x}(\tg\varphi)} & {\displaystyle\frac{\partial}{\partial x}\left(\frac{y}{x}\right) = -\frac{y}{x^2}}.
		\arrow[equals, from=1-2, to=1-1]
		\arrow[equals, from=1-2, to=1-3]
	\end{tikzcd}\]
	Отсюда находим $\displaystyle\frac{\partial\varphi}{\partial x} = -\frac{y}{x^2}\cos^2\varphi = -\frac{\sin\varphi}{\rho}$. Итого,
	\[
		\frac{\partial V}{\partial x} = \frac{\partial V}{\partial \rho}\cos\varphi - \frac{\partial V}{\partial \varphi} \frac{\sin\varphi}{\rho}.
	\]
	Аналогично находим
	\[
		\frac{\partial V}{\partial y} = \frac{\partial V}{\partial\rho}\frac{\cos\varphi}{\rho} + \frac{\partial V}{\partial \varphi}\sin\varphi.
	\]
	Переходим к нахождению вторых производных.
	\begin{multline*}
		\frac{\partial^2V}{\partial x^2} = \frac{\partial}{\partial x}\br{\frac{\partial V}{\partial x}} = \frac{\partial}{\partial\rho}\br{\frac{\partial V}{\partial x}} \cdot \frac{\partial\rho}{\partial x} + \frac{\partial}{\partial\varphi}\br{\frac{\partial V}{\partial x}} \cdot \frac{\partial\varphi}{\partial x} =\\ = \br{\frac{\partial^2V}{\partial\rho^2}\cos\varphi - \frac{\partial^2V}{\partial\varphi\partial\rho}\frac{\sin\varphi}{\rho} + \frac{\partial V}{\partial\varphi}\frac{\sin\varphi}{\rho^2}} \cdot \cos\varphi + {}\\{} + \br{\frac{\partial^2 V}{\partial\rho\partial\varphi}\cos\varphi - \frac{\partial V}{\partial\rho}\sin\varphi - \frac{\partial^2V}{\partial\varphi^2}\frac{\sin\varphi}{\rho} - \frac{\partial V}{\partial\varphi}\frac{\cos\varphi}{\rho}} \cdot \br{-\frac{\sin\varphi}{\rho}}.
	\end{multline*}
	Раскрывая скобки, получаем
	\[
		\frac{\partial^2V}{\partial x^2} = \frac{\partial^2V}{\partial\rho^2}\cos^2\varphi - \frac{\partial^2V}{\partial\rho\partial\varphi}\frac{\sin 2\varphi}{\rho} + \frac{\partial^2V}{\partial\varphi^2}\frac{\sin^2\varphi}{\rho^2} + \frac{\partial V}{\partial\varphi}\frac{\sin 2\varphi}{\rho^2} + \frac{\partial V}{\partial\rho}\frac{\sin^2\varphi}{\rho}.
	\]
	Аналогично находим
	\[
		\frac{\partial^2V}{\partial y^2} = \frac{\partial^2 V}{\partial\rho^2}\sin^2\varphi + \frac{\partial^2V}{\partial\rho\partial\varphi}\frac{\sin 2\varphi}{\rho} + \frac{\partial^2V}{\partial\varphi^2}\frac{\cos^2\varphi}{\rho^2} + \frac{\partial V}{\partial\rho}\frac{\cos^2\varphi}{\rho} - \frac{\partial V}{\partial\varphi}\frac{\sin 2\varphi}{\rho^2}.
	\]
	Полученные выражения нужно сложить:
	\begin{multline*}
		\Delta V = \frac{\partial V}{\partial x^2} + \frac{\partial V}{\partial y^2} = \frac{\partial^2 V}{\partial\rho^2}\underbrace{(\cos^2\varphi + \sin^2\varphi)}_{1} + \frac{\partial^2V}{\partial\varphi^2}\underbrace{\br{\frac{\sin^2\varphi + \cos^2\varphi}{\rho^2}}}_{1 / \rho^2} + {}\\{} + \frac{\partial V}{\partial\rho\partial\varphi}\underbrace{\br{-\frac{\sin 2\varphi}{\rho} + \frac{\sin 2\varphi}{\rho}}}_{0} + \frac{\partial V}{\partial\rho}\underbrace{\br{\frac{\sin^2\varphi + \cos^2\varphi}{\rho}}}_{1 / \rho} + \frac{\partial V}{\partial\varphi}\underbrace{\br{-2\frac{\sin 2\varphi}{\rho^2} + 2\frac{\sin 2\varphi}{\rho^2}}}_{0}.
	\end{multline*}

	\noindent
	Получаем итоговое выражение оператора Лапласа в полярных координатах:
	\[
		\Delta V = \frac{\partial^2V}{\partial\rho^2} + \frac{1}{\rho^2}\frac{\partial^2V}{\partial\varphi^2} + \frac{1}{\rho}\frac{\partial V}{\partial\rho}.
	\]
	Эту формулу часто записывают в виде
	\[
		\Delta V = \frac{1}{\rho}\frac{\partial}{\partial\rho}\br{\rho\frac{\partial V}{\partial{\rho}}} + \frac{1}{\rho^2}\frac{\partial^2V}{\partial\varphi^2}.
	\]
\end{solution}

\vspace{-.3cm}\subsection{Риманова метрика в криволинейных координатах}

Функции $x^i = x^i(u^1, \ldots, u^n)$ удобно рассматривать одновременно для всех $i = 1, \ldots, n$, используя для этого вектор-функцию
\[
	\vec{r} = \vec{r}(u^1, \ldots, u^n),\text{ где $\vec{r} = (x^1, \ldots, x^n)$}.
\]

Векторы $\vec{r}_k = \partial \vec{r} / \partial u^k$ имеют направления касательных к координатным линиям, так что в каждой точке области $U$ они линейно независимы. Они определяют в окрестности некоторой точки $(u^1, \ldots, u^n)$ малый вектор $d\vec{r} = \vec{r}du^i$. Квадрат его длины, выраженный в криволинейных координатах, определяет метрику:
\[
	ds^2 = \langle d\vec{r}, d\vec{r}\rangle = \left\langle\vec{r}_idu^i, \vec{r}_jdu^j\right\rangle = g_{ij}du^idu^j,
\]
где $g_{ij} = \langle\vec{r}_i, \vec{r}_j\rangle$ --- элементы матрицы Грама векторов $\vec{r}_1, \ldots, \vec{r}_n$. При переходе к другим координатам $\widetilde{u}^1, \ldots, \widetilde{u}^n$ матрица Грама преобразуется так, как и положено преобразовываться матрице квадратичной формы (по тензорному закону):
\begin{equation} \label{eq:RiemannCoordinates}
	\widetilde{g}_{ij} = \left\langle\frac{\partial \vec{r}}{\partial\widetilde{u}^i}, \frac{\partial \vec{r}}{\partial\widetilde{u}^j}\right\rangle = \left\langle\frac{\partial \vec{r}}{\partial u^k}\frac{\partial u^k}{\partial\widetilde{u}^i}, \frac{\partial \vec{r}}{\partial u^l}\frac{\partial u^l}{\partial\widetilde{u}^j}\right\rangle = \frac{\partial u^k}{\partial\widetilde{u}^i}\frac{\partial u^l}{\partial\widetilde{u}^j}g_{kl}.
\end{equation}

\begin{definition} \label{definition:RiemannMetrics}
	Говорят, что в области $U \subset \R^n$ задана \textit{риманова метрика}, если для любой криволинейной системы координат $(u^1, \ldots, u^n)$ в $U$ задана матрица $g_{ij}(u)$, которая:
	\begin{enumerate}[nolistsep, label=(\arabic*)]
		\item симметрична: $g_{ij}(u) = g_{ji}(u)$;
		\item невырожденна и положительно определена;
		\item при замене координат изменяется по формулам \eqref{eq:RiemannCoordinates}.
	\end{enumerate}
\end{definition}

Пусть имеем параметризованную кривую $\vec{r}(t)$ в криволинейных координатах $(u^1, \ldots, u^n)$ с римановой метрикой, заданной матрицей $G = g_{ij}$. Измеряем длину кривой, заметаемой при изменении параметра от $a$ до $b$:
\begin{equation} \label{eq:RiemannLength}
	l = \int\limits_a^b\abs{\frac{d\vec{r}}{dt}}dt = \int\limits_a^b\sqrt{\left\langle \frac{d\vec{r}}{dt}, \frac{d\vec{r}}{dt} \right\rangle}\,dt = \int\limits_a^b\sqrt{\frac{ds^2}{(dt)^2}}\,dt = \int\limits_a^b\sqrt{g_{ij}\frac{du^i}{dt}\frac{du^j}{dt}}\,dt.
\end{equation}

\begin{problem}
	Проверить, что матрица
	\[
		\G(u, v) = \frac{1}{1 - u^2 - v^2}
		\begin{pmatrix}
			1 - v^2 & uv\\
			uv & 1 - u^2
		\end{pmatrix}
	\]
	задаёт риманову метрику в единичном круге на плоскости с координатами $(u, v)$. Вычислить в этой метрике длину кривой $u^2 + v^2 = a^2$, где $0 < a < 1$.
\end{problem}

\begin{proof}
	Нужно проверить лишь то, что матрица $G$ невырожденна и положительно определена, для этого можно воспользоваться критерием Сильвестра. Для минора $1 \times 1$ всё очевидно, остаётся проверить знак определителя всей матрицы $2 \times 2$:
	\[
		\det\G = \frac{(1 - v^2)(1 - u^2) - u^2v^2}{1 - u^2 - v^2} = \frac{\cancel{1 - u^2 - v^2}}{\cancel{1 - u^2 - v^2}} = 1.
	\]
	
	Если параметризовать нашу кривую как $\vec{r}(t) = (u(t), v(t))$, где $u(t) = a\cos t$, $v(t) = a\sin t$ (где $t$ меняется от $0$ до $2\pi$), то длина вычисляется по формуле \eqref{eq:RiemannLength}:
	\[
		l = \int\limits_0^{2\pi}\sqrt{\begin{pmatrix}\dot{u}(t) & \dot{v}(t)\end{pmatrix} \G \begin{pmatrix}\dot{u}(t) \\ \dot{v}(t) \end{pmatrix}}\,dt.
	\]
	Подставляем:
	\begin{multline*}
		\int\limits_0^{2\pi}\sqrt{\begin{pmatrix}-a\sin t & a\cos t\end{pmatrix} \cdot \left(\frac{1}{1 - a^2}\begin{pmatrix} 1 - a^2\sin^2t & a^2\sin t\cos t \\ a^2\sin t\cos t & 1 - a^2\cos^2t \end{pmatrix}\right) \cdot \begin{pmatrix} -a\sin t \\ a\cos t \end{pmatrix}}\,dt =\\ = \int\limits_0^{2\pi}\sqrt{\begin{pmatrix} -a\sin t & a\cos t \end{pmatrix} \cdot \left(\frac{1}{\cancel{1 - a^2}}\begin{pmatrix} -a\sin t\cancel{(1 - a^2)} \\ a\cos t\cancel{(1 - a^2)}\end{pmatrix}\right)}\,dt =\\ = \int\limits_0^{2\pi}\sqrt{a^2(\cos^2t + \sin^2t)}\,dt = \int\limits_0^{2\pi}a\,dt = 2\pi a.
	\end{multline*}
\end{proof}

Правильно думать, что матрица $\G(u^1, \ldots, u^n)$ (как матрица Грама линейно независимых векторов) симметрична и положительно определена, а потому задаёт скалярное произведение (своё в каждой точке области $U \subset \R^n$). В криволинейной системе координат $(u^1, \ldots, u^n)$ мы работаем именно в этом скалярном произведении. Например, можем считать длины кривых (что уже было продемонстрировано) или углы между кривыми.

\begin{problem}
	Найти угол между кривыми $v = 2u + 1$ и $v = -2u + 1$ на плоскости с координатами $(u, v)$ с метрикой
	\[
		ds^2 = 2du^2 + 2dudv + 4dv^2.
	\]
\end{problem}

\begin{solution}
	Данная в условии метрика задаётся матрицей
	\[
		\G =
		\begin{pmatrix}
			2 & 1\\
			1 & 4
		\end{pmatrix}.
	\]

	Параметризуем обе эти кривые: $\vec{r}_1(t) = (t, 2t + 1)$, $\vec{r}_2(t) = (t, -2t + 1)$. Они пересекаются в единственной точке $(0, 1)$ при $t = 0$. Вектора скорости этих кривых в данной точке есть $\vec{v}_1 = (1, 2)$, $\vec{v}_2 = (1, -2)$. Находим угол между этими векторами по формуле:
	\[
		\cos\angle(\vec{v}_1, \vec{v}_2) = \frac{\langle\vec{v}_1, \vec{v}_2\rangle_\G}{\sqrt{\langle\vec{v}_1, \vec{v}_1\rangle_\G} \cdot \sqrt{\langle\vec{v}_2, \vec{v}_2\rangle_\G}} = \frac{-14}{\sqrt{22} \cdot \sqrt{14}} = -\sqrt{\frac{7}{11}}.
	\]
	Отсюда получаем $\angle(\vec{v}_1, \vec{v}_2) = \arccos\sqrt{\frac{7}{11}}$.
\end{solution}

\subsection{Двумерные поверхности в трёхмерном пространстве}

\begin{definition}
	\textit{Простым куском поверхности} в $\R^3$ называется подмножество в $\R^3$, гомеоморфное двумерному диску $D^2$.
\end{definition}

\begin{definition}
	Если $\M$ --- простой кусок поверхности, то гомеоморфизм $\vec{r}\colon \Omega \to \M$, где $\Omega$ --- некоторая плоская область\footnotemark, называется \textit{параметризацией} куска $\M$. Параметризация называется \textit{гладкой}, если таково отображение $\vec{r}$, и \textit{регулярной}, если область $\Omega$ имеет кусочно-гладкую границу и ранг матрицы Якоби $J_{\vec{r}}$ равен двум во всех точках области $\Omega$.
\end{definition}

\footnotetext{У Ивана Алексеевича здесь фигурирует \underline{простая} область, но я пока не понимаю, зачем накладывать такое ограничение. Оно здесь, кажется, совсем не нужно.}

\begin{definition}
	Простой кусок поверхности называется \textit{гладким}, если он допускает регулярную параметризацию.

	\textit{Гладкой поверхностью} в $\R^3$ будем называть любое подмножество $\M \subset \R^3$ такое, что для любой точки $\vec{x} \in \R^3$ пересечение $\M \cap \overline{B}_\eps(\vec{x})$ множества $\M$ с некоторым замкнутым шаром с центром в точке $\vec{x}$ либо пусто, либо является гладким простым куском поверхности.

	Любой гладкий простой кусок поверхности, содержащийся в $\M$, будем называть \textit{куском} поверхности $\M$.
\end{definition}

Это определение Ивана Алексеевича, и вот что он сам пишет по этому поводу:

\begin{center}
	<<\textit{Данное определение содержит ряд ограничений на поверхность, которые не являются общепринятыми или обязательными для доказательства нижеследующих теорем\ldots\ Эти ограничения наложены из соображений краткости изложения}>>.
\end{center}

\begin{definition}
	Точка $\vec{x}$ простого куска поверхности $\M$ называется для него \textit{внутренней}, если она соответствует внутренней точке области $\Omega$ при некоторой параметризации $\Omega \to \M$. В противном случае она называется \textit{граничной}.
\end{definition}

\begin{proposition}
	Данное выше определение внутренней точки простого куска поверхности корректно, то есть не зависит от параметризации.
\end{proposition}

\begin{proof}
	Пусть $\vec{r}_1\colon \Omega_1 \to \M$ и $\vec{r}_2\colon \Omega_2 \to \M$ --- две параметризации простого куска поверхности $\M$, точка $\vec{x} \in \M$ соответствует некоторой внутренней точке области $\Omega_1$. Так как отображение $\vec{r}_2$ является гомеоморфизмом, то у точки $\vec{x}$ есть окрестность $U_{\vec{x}}$, гомеоморфная диску открытому $\Int D^2$. Но тогда и у прообраза точки $\vec{x}$ при отображении $\vec{r}_2$ тоже есть окрестность, гомеоморфная открытому диску.
\end{proof}

\begin{definition}
	Точка $\vec{x}$ гладкой поверхности $\M$ называется для этой поверхности \textit{внутренней}, если для некоторого шара $\overline{B}_\eps(\vec{x})$ она является внутренней точкой простого куска $\M \cap \overline{B}_\eps(\vec{x})$. В противном случае она называется \textit{граничной}. Множество все граничных точек поверхности называется её \textit{краем} и обозначается через $\partial\M$.
\end{definition}

\begin{proposition}
	Покажите, что край поверхности либо пусть, либо состоит из не более чем счётного числа простых (замкнутых или незамкнутых) кривых.
\end{proposition}

\begin{proof} % TODO: Дописать!
	Появится позднее.
\end{proof}

В дальнейшем мы будем использовать (более или менее) единую систему обозначений, не оговаривая её каждый раз. Евклидовы координаты в $\R^2$ будут обозначаться через $x$, $y$ (или, когда это удобно, через $x^1$ и $x^2$), аналогично для евклидовых координат в $\R^3$. Мы будем в основном рассматривать локальные свойства поверхностей, и тогда будем предполагать, что дана регулярная параметризация некоторого её куска, то есть отображение $\vec{r}$ из некоторой области $\Omega \subset \R^2$ в $\M$. Параметры в соответствующей области $\Omega$ будут как правило обозначаться через $u$, $v$ (в иных случаях --- через $u^1$, $u^2$) и использоваться в формулах как криволинейные координаты на соответствующем простом куске поверхности. Поскольку эти координаты параметризуют только кусок поверхности, они будем называть их \textit{локальными координатами}. Если на куске заданы две локальные системы координат, то функции, выражающие одни через другие будут называться \textit{функциями перехода}.

\begin{proposition}
	В окрестности внутренней точки $\vec{x}_0$ гладкая поверхность в $\R^3$ может быть задана (без ограничения общности) уравнением вида
	\[
		z = f(x, y),
	\]
	где $f$ --- некоторая гладкая функция. В этой окрестности любые другие локальные координаты выражаются через $(x, y)$ гладкими функциями.
\end{proposition}

\begin{proof}
	Пусть $u$, $v$ --- локальные координаты в окрестности точки $\vec{x}_0$, соответствующие некоторой регулярной параметризации $\vec{r}$, тогда $\rk J_{\vec{r}}(\vec{x}_0) = 2$. Без ограничения общности можем считать, что невырожден минор $(\partial r^i / \partial x^j)_{i = 1, 2}^{j = 1, 2}$, тогда по теореме об обратной функции координаты $(u, v)$ в окрестности точки $\vec{x}_0$ можно выразить на данной поверхности через $(x, y)$ гладкими функциями: $u = \varphi(x, y)$, $v = \psi(x, y)$. Получим, что в этой окрестности поверхность задаётся уравнением
	\[
		z = r^3\big(\varphi(x, y),\,\psi(x, y)\big),
	\]
	что и требовалось.
\end{proof}

\begin{corollary} \label{corollary:SmoothLocal}
	Функции перехода между локальными координатами всегда гладкие.
\end{corollary}

\begin{proof}
	Пусть $(u, v)$ и $(\widetilde{u}, \widetilde{v})$ --- две локальные системы координат в окрестности точки $\vec{x}_0$. В, возможно меньшей, окрестности этой точки можно гладко выразить координаты $(u, v)$ через евклидовы $(x, y)$, а их, в свою очередь, гладко через $(\widetilde{u}, \widetilde{v})$.
\end{proof}

\begin{corollary}
	Пусть $F\colon \R^m \to \R^3$ --- гладкое отображение, причём $\Im F \subset \M$, где $\M$ --- гладкая поверхность в $\R^3$. Тогда для любой точки $\vec{y}_0 \in \R^m$ и любой регулярной параметризации $\vec{r}(u, v)$ поверхности $\M$ в окрестности точки $F(\vec{y}_0)$ найдутся гладкие функции $\varphi, \psi\colon \R^m \to \R$ такие, что в этой окрестности точки $\vec{y}_0$ следующая диаграмма коммутативна:

	\shorthandoff{"}%
	\[\begin{tikzcd}
		{\R^m} \\
		&& {\mathcal{M} \subset\R^3} \\
		{\R^2}
		\arrow["F", from=1-1, to=2-3]
		\arrow["{\varphi \times \psi}"', from=1-1, to=3-1]
		\arrow["{\boldsymbol{r}}"', from=3-1, to=2-3]
	\end{tikzcd}\]
	\shorthandoff{"}%
\end{corollary}

\begin{proof}
	Поскольку любая пара локальных координат выражается через любую другую гладкими функциями, справедливость утверждения достаточно установить для какой-либо одной параметризации. Но для параметризации, заданной парой евклидовых координат, утверждение очевидно.
\end{proof}

\begin{proposition}
	Пусть $F\colon \R^3 \to \R$ --- гладкая функция, $\vec{x}_0$ --- её регулярная точка такая, что $F(\vec{x}_0) = 0$. Тогда в достаточно малой окрестности точки $\vec{x}_0$ уравнение $F(\vec{x}) = 0$ задаёт гладкую поверхность.
\end{proposition}

\begin{proof}
	Без ограничения общности можем считать, что в точке $\vec{x}_0$ производная $\partial F / \partial z$ отлична от нуля. Тогда по теореме о неявной функции в некоторой окрестности точки $\vec{x}_0$ уравнение $F(\vec{x}) = 0$ равносильно уравнению $z = f(x, y)$, где $f$ --- некоторая гладкая функция. Таким образом, в этой окрестности множество решений уравнения $F(\vec{x}) = 0$ параметризуется следующим образом:
	\[
		\vec{r}(u, v) = \big(u, v, f(u, v)\big).
	\]

	Легко видеть, что первые два столбца матрицы Якоби $J_{\vec{r}}(\vec{x}_0)$ составляют единичную матрицу, поэтому данная параметризация регулярна.
\end{proof}

\subsection{Поверхности как двумерные многообразия}

Рассмотрим гладку кривую, лежащую на поверхности. Если поверхность задана параметрически, то кривая представляется как композиция отображений $I \to \Omega \to \M$:
\[
	t \mapsto \big(u(t), v(t)\big) \mapsto \vec{r}\big(u(t), v(t)\big).
\]
Вектор скорости равен
\[
	\frac{d\vec{r}\big(u(t), v(t)\big)}{dt} = \vec{r}_u\dot{u} + \vec{r}_v\dot{v}.
\]

Более того, любой вектор вида $\vec{\xi} = \xi^1\vec{r}_u(u_0, v_0) + \xi^2\vec{r}_v(u_0, v_0)$ является вектором скорости некоторой кривой на поверхности. Например, можно взять кривую, имеющую в локальных координатах вид
\[
	u = u_0 + \xi^1t,\quad v = v_0 + \xi^2t.
\]

Эти векторы образуют двумерное векторное пространство, называемое \textit{касательным пространством} в точке $\vec{r}(u_0, v_0)$, причём векторы $\vec{r}_u(u_0, v_0)$ и $\vec{r}_v(u_0, v_0)$ задают базис этого пространства (условие регулярности параметризации $\vec{r}$).

На координаты бывает полезно смотреть как на функции. В нашем случае локальные координаты $u$ и $v$ на куске $U$ поверхности суть гладкие на этом куске функции $u(x, y)$ и $v(x, y)$ от координат $x$ и $y$ в области $V \subset \R^n$. Если $f(x, y)$ --- такая функция, то её дифференциалу можно придать смысл как линейной функции на касательном пространстве:
\[
	(df)(\vec{r}_u) = \frac{\partial f}{\partial u},\quad(df)(\vec{r}_v) = \frac{\partial f}{\partial v},
\]
далее по линейности. Легко видеть, что $(du)(\vec{r}_u) = 1$, $(dv)(\vec{r}_v) = 1$ и $(du)(\vec{r}_v) = (dv)(\vec{r}_u) = 0$. Таким образом, линейные функции $du$ и $dv$ образуют двойственный к $\vec{r}_u, \vec{r}_v$ базис двойственного пространства к касательному. Это пространство называется \textit{кокасательным пространством} в точке $\vec{r}(u_0, v_0)$.

Ситуация с касательными векторами хорошо описывается в книге \cite{S19} (глава 1, \S 4):

\begin{center}
	\textit{<<Касательные векторы имеют двойственную природу. С одной стороны, у них имеется геометрический аспект, заключающийся в том, что они задают направления в пространстве: если я стою на многообразии, то могу двигаться в различных направлениях, которые можно описать касательными векторами в точке моего положения. С другой стороны, у них имеется аналитический аспект, в котором они выступают как \glqq производные по направлению\grqq>>.}
\end{center}

\begin{example}
	\begin{enumerate}[nolistsep, label=(\arabic*)]
		\item Если поверхность задана уравнением $F(x, y, z) = 0$, то её касательное пространство состоит из векторов, перпендикулярных градиенту $\nabla F$ (см. напоминания из аналитической геометрии).
		\item Если поверхность задана как график функции $z = f(x, y)$, то векторы $(1, 0, f_x)$ и $(0, 1, f_y)$ задают базисы в касательных пространствах.
	\end{enumerate}
\end{example}

На регулярной поверхности $\M \subset \R^3$ можно рассмотреть открытое покрытие внутренностями простых кусков этой поверхности. Согласно теореме Линделёфа\footnotemark, такая поверхность покрывается не более чем счётным набором этих простых кусков: $\M = \bigcup_\alpha U_\alpha$, при этом

\footnotetext{Если топологическое пространство обладает не более чем счётной базой, то из всякого открытого покрытия этого пространства можно выделить не более чем счётное подпокрытие.}

\begin{enumerate}[nolistsep, label=(\arabic*)]
	\item в каждой куске $U_\alpha$ можно ввести локальные координаты $(x^1_\alpha, x^2_\alpha)$;
	\item локальные координаты $(x^1_\alpha, x^2_\alpha)$ принимают значения в некоторой области $V_\alpha \subset \R^2$, и каждой точке из области $V_\alpha$ соответствует в точности одна точка из куска $U_\alpha$ на поверхности.
	\item в пересечении $U_\alpha \cap U_\beta$ локальные координаты $(x^1_\alpha, x^2_\alpha)$ и $(x^1_\beta, x^2_\beta)$ связаны взаимно обратными гладкими отображениями --- заменами координат
		\[
			x^i_\alpha = x^i_\alpha(x^1_\beta, x^2_\beta),\quad x^j_\beta = x^j_\beta(x^1_\alpha, x^2_\alpha),\qquad i, j = 1, 2,
		\]
		с ненулевыми якобианами:
		\[
			\det\br{\frac{\partial x^i_\alpha}{\partial x^j_\beta}} \ne 0,\quad \det\br{\frac{\partial x^i_\beta}{\partial x^j_\alpha}} \ne 0.
		\]
\end{enumerate}

\begin{definition}
	Совокупность областей $U_\alpha$, удовлетворяющих свойствам $1$ "---$3$ называется \textit{атласом поверхности}, а сами области $U_\alpha$ называются \textit{картами}.
\end{definition}

Теперь мы можем перенести на случай регулярных поверхностей некоторые определения из анализа:

\begin{enumerate}[nolistsep]
	\item[(а)] \textit{областью} на поверхности $\M$ называется такое множество точек $U \subset \M$, что координаты $(x_\alpha^1, x_\alpha^2)$ точек из пересечения множества $U$ с любой картой $U_\alpha$, заполняют область в $\R^2$;
	\item[(б)] любая область $U$, содержащая точку $\vec{x} \in \M$, называется \textit{окрестностью} точки $\vec{x}$;
	\item[(в)] функция $f\colon \M \to \R$ называется \textit{гладкой}, если в каждой карте $U_\alpha$ она задаётся как гладкая функция локальных координат $(x_\alpha^1, x_\alpha^2)$.
	\item[(г)] Отображение поверхностей $\vec{f}\colon \M_1 \to \M_2$ называется \textit{гладким}, если всюду в локальных координатах оно задаётся гладкими функциями
		\[
			(x, y) \mapsto \big(u(x, y), v(x, y)\big),
		\]
		где $(x, y)$ --- локальные координаты на $\M_1$, а $(u, v)$ --- локальные координаты на $\M_2$
\end{enumerate}

Из следствия \ref{corollary:SmoothLocal} и теоремы о дифференцируемости сложной функции вытекает, что гладкость функции на поверхности в точке $\vec{x}_0$ достаточно проверить в какой-либо одной локальной системе координат в окрестности $\vec{x}_0$. В частности, получаем корректность определения гладкой функции на поверхности. Однако заметим, что имеет смысл говорить только о гладкости функций, меньшей, чем гладкость замен локальных координат, иначе это понятие станет неинвариантным. Обычно мы говорим о бесконечно гладких параметризациях (класс $C^\infty$), так что этот вопрос не возникает.

Определение гладкого отображения поверхностей корректно по тем же причинам, что и определение гладкой функции на поверхности.

Заметим, что регулярные поверхности в $\R^3$ обладают дополнительным свойством хаусдорфовости:
\begin{enumerate}[nolistsep, label=(\arabic*)]
	\item[(4)] для любой пары различных точек $\vec{x}$, $\vec{y}$ на поверхности существуют их окрестности $U$ и $V$, которые не пересекаются:
		\[
			U \cap V = \varnothing,\quad \vec{x} \in U,\quad \vec{y} \in V.
		\]
\end{enumerate}

\begin{definition}
	Совокупность точек, для которой задан атлас, удовлетворяющий условиям $1$ "---$4$, называется \textit{двумерным гладким многообразием}.
\end{definition}

\begin{definition}
	\textit{Касательным вектором} $\vec{\xi}$ в точке $\vec{x}_0$ двумерного многообразия называется вектор скорости гладкой кривой $\vec{r}(t)$ в точке $\vec{x}_0$:
	\[
		\vec{\xi} = \left.\frac{d\vec{r}}{dt}\right|_{t_0},\quad \vec{r}(t_0) = \vec{x}_0.
	\]
\end{definition}

В разных координатах он записывается по-разному. Если точка $\vec{x}_0$ лежит в пересечении двух карт $U_\alpha$ и $U_\beta$ и в координатах $(x_\alpha^1, x_\alpha^2)$ мы имеем
\[
	\vec{\xi}_\alpha = (\dot{x}^1_\alpha, \dot{x}^2_\alpha),
\]
то по теореме о производной сложной функции в координатах $(x_\beta^1, x_\beta^2)$ этот же касательный вектор записывается как
\[
	\vec{\xi}_\beta = \br{\frac{dx_\beta^1(x_\alpha^1(t), x_\alpha^2(t))}{dt}, \frac{dx_\beta^2(x_\alpha^1(t), x_\alpha^2(t))}{dt}} = \br{\frac{\partial x_\beta^1}{\partial x^i_\alpha}\dot{x}_\alpha^i, \frac{\partial x_\beta^2}{\partial x^i_\alpha}\dot{x}_\alpha^i}.
\]

Поэтому касательный вектор в точке $\vec{x}_0$ может быть определён как объект $\vec{\xi} = (\xi^1, \xi^2)$, записи которого $\vec{\xi}_\alpha$, $\vec{\xi}_\beta$ в различных локальных координатах связаны соотношением
\[
	\xi_\beta^i = \left.\frac{\partial x_\beta^i}{\partial x_\alpha^j}\right|_{\vec{x}_0}\xi^j_\alpha.
\]

\begin{definition}
	Все касательные векторы в точке $\vec{x}$ двумерного многообразия $\M$ образуют векторное пространство, которое называется \textit{касательным пространством} в точке $\vec{x}$ и обозначается через $\T_{\vec{x}}\M$.
\end{definition}

\subsection{Риманова метрика на поверхностях}

В окрестности каждой точки поверхности можно ввести локальные криволинейные координаты. Они, как обсуждалось выше, задают риманову метрику. На пересечениях атласов гладкие функции перехода дают согласованность между атласами. Таким образом, получаем естественное определение римановой метрики на поверхности.

Пусть на поверхности $\vec{r}(u, v)$ задана кривая $(u(t), v(t))$. Вектор скорости есть
\[
	(\dot{x}, \dot{y}, \dot{z}) = \vec{r}_u\dot{u} + \vec{r}_v\dot{v},
\]
где
\[
	\dot{x} = x_u\dot{u} + x_v\dot{v},\quad
	\dot{y} = y_u\dot{u} + y_v\dot{v},\quad
	\dot{z} = z_u\dot{u} + z_v\dot{v}.
\]
Длина (фрагмента) этой кривой равна
\[
	l = \int\limits_a^b\sqrt{\dot{x}^2 + \dot{y}^2 + \dot{z}^2}\,dt.
\]
Подставляя в подынтегральное выражение формулы для $\dot{x}$, $\dot{y}$ и $\dot{z}$, получаем
\[
	\dot{x}^2 + \dot{y}^2 + \dot{z}^2 = E\dot{u}^2 + 2F\dot{u}\dot{v} + G\dot{v}^2,
\]
где
\begin{gather*}
	E = \langle\vec{r}_u, \vec{r}_u\rangle = x_u^2 + y_u^2 + z_u^2,\\
	F = \langle\vec{r}_u, \vec{r}_v\rangle = x_ux_v + y_uy_v + z_uz_v,\\
	G = \langle\vec{r}_v, \vec{r}_v\rangle = x_v^2 + y_v^2 + z_v^2.
\end{gather*}

Для использования нотации Эйнштейна коэффициенты $E$, $F$ и $G$ можно обозначать через матрицу Грама
\[
	\begin{pmatrix}
		E & F\\
		F & G
	\end{pmatrix} = \vcentcolon
	\begin{pmatrix}
		g_{11} & g_{12}\\
		g_{12} & g_{22}
	\end{pmatrix} = \G,
\]
а координаты $u$ и $v$ --- через $x^1$ и $x^2$.

\begin{definition}
	Выражение
	\[
		ds^2 = g_{ij}dx^idx^j = Edu^2 + 2Fdudv + Gdv^2
	\]
	называется \textit{первой квадратичной формой} (или \textit{римановой метрикой}) на поверхности. Здесь коэффициенты матрицы $\G = g_{ij}$, вообще говоря, зависят от координат $u$ и $v$.
\end{definition}

В каждой точке поверхности эта форма задаёт на касательном пространстве евклидово скалярное произведение:
\[
	\vec{\xi} = \xi^i\frac{\partial \vec{r}}{dx^i},\ \vec{\eta} = \eta^j\frac{\partial \vec{r}}{\partial x^j} \leadsto \langle\vec{\xi}, \vec{\eta}\rangle_\G = g_{ij}\xi^i\eta^j.
\]

С помощью него можно, например, находить длины кривых и углы между кривыми на поверхностях (что мы, на самом деле, раньше уже делали). Но сперва нужно доказать корректность этого определения, то есть согласованность с тем, что мы раньше называли римановой метрикой (определение \ref{definition:RiemannMetrics}).

\begin{proposition}
	Коэффициенты первой квадратичной формы, записанной по отношению к разным системам координат $(x^1, x^2)$ и $(\widetilde{x}^1, \widetilde{x}^2)$, связаны соотношениями
	\[
		g_{ij} = \widetilde{g}_{kl}\frac{\partial\widetilde{x}^k}{\partial x^i}\frac{\partial \widetilde{x}^l}{\partial x^j}.
	\]
\end{proposition}

\begin{proof}
	Пусть в какой-то области поверхности введены две разные системы координат $(x^1, x^2)$ и $(\widetilde{x}^1, \widetilde{x}^2)$, связанные формулами перехода. Один и тот же касательный вектор раскладывается по разным базисам:
	\[
		\vec{\xi} = \xi^i\frac{\partial\vec{r}}{\partial x^i} = \widetilde{\xi}^j\frac{\partial\vec{r}}{\partial\widetilde{x}^j}.
	\]
	Так как его длина не зависит от базиса, мы имеем
	\[
		g_{ij}\xi^i\xi^j = \widetilde{g}_{kl}\widetilde{\xi}^k\widetilde{\xi}^l.
	\]

	Равенство длин переписывается как $g_{ij}dx^idx^j = \widetilde{g}_{ij}d\widetilde{x}^id\widetilde{x}^j$. Подставляя в правую часть выражения вида $\ds d\widetilde{x}^k = \frac{\partial\widetilde{x}^k}{\partial x^i}dx^i$, получаем
	\[
		d_{ij}dx^idx^j = \widetilde{g}^{kl}\frac{\partial\widetilde{x}^k}{\partial x^i}\frac{\partial\widetilde{x}^l}{\partial x^j}dx^idx^j.
	\]
	Равенство форм означает равенство всех коэффициентов, что и требовалось.
\end{proof}

\begin{definition}
	Гладкое отображение поверхностей называется \textit{изометрией}, если оно сохраняет длины всех кривых.
\end{definition}

\begin{example}
	\begin{enumerate}[nolistsep, label=(\arabic*)]
		\item Если поверхность задана как график функции $z = f(x, y)$, то
			\begin{gather*}
				\vec{r}_x = (1, 0, f_x),\quad\vec{r}_y = (0, 1, f_y),\\
				g_{11} = \langle\vec{r}_x, \vec{r}_x\rangle = 1 + f_x^2,\quad g_{12} = \langle\vec{r}_x, \vec{r}_y\rangle = f_xf_y,\quad g_{22} = \langle\vec{r}_v, \vec{r}_v\rangle = 1 + f_y^2.
			\end{gather*}
		\item Пусть поверхность задана уравнением $F(x, y, z) = 0$ и $F_z \ne 0$ в окрестности точки $(x_0, y_0, z_0)$. Примем $x$ и $y$ за локальные координаты: $u = x$, $v = y$. Условие $F = 0$ влечёт тождество
			\[
				F_x\dot{x} + F_y\dot{y} + F_z\dot{z} = 0
			\]
			для касательных векторов $(\dot{x}, \dot{y}, \dot{z})$ к поверхности. Из него следует, что
			\[
				\dot{z} = -\frac{1}{F_z}(F_x\dot{x} + F_y\dot{y}).
			\]
			Отсюда выводим, что
			\begin{multline*}
				\dot{x}^2 + \dot{y}^2 + \dot{z}^2 = \dot{x}^2 + \dot{y}^2 + \frac{1}{F_z^2}(F_x^2\dot{x}^2 + 2F_xF_y\dot{x}\dot{y} + F_y^2\dot{y}^2) =\\ = \br{1 + \frac{F_x^2}{F_z^2}}\dot{x} + 2\frac{F_xF_y}{F_z^2}\dot{x}\dot{y} + \br{1 + \frac{F_y^2}{F_z^2}}\dot{y}^2.
			\end{multline*}
			В итоге получаем следующие формулы для метрики:
			\[
				g_{11} = 1 + \frac{F_x^2}{F_z^2},\quad g_{12} = \frac{F_xF_y}{F_z^2},\quad g_{22} = 1 + \frac{F_y^2}{F_z^2}.
			\]
	\end{enumerate}
\end{example}

\begin{problem}
	Вычислить первую квадратичную форму
	\begin{enumerate}[nolistsep, label=(\arabic*)]
		\item \textit{псевдосферы Бельтрами}
			\[
				x = a\sin u\cos v,\quad y = a\sin u\sin v,\quad z = a\br{\ln\tg\frac{u}{2} + \cos u},
			\]
			где $u \ne \pi / 2$, $a = \const$.
		\item \textit{поверхности главных нормалей} $\vec{r}(s, \lambda) = \vec{\rho}(s) + \lambda\vec{n}(s)$ кривой $\vec{\rho}(s)$.
	\end{enumerate}
\end{problem}

\begin{solution}
	\begin{enumerate}[nolistsep, label=(\arabic*)]
		\item Напрямую вычисляем коэффициенты\footnotemark:
			\begin{gather*}
				\vec{r}_u = \br{a\cos u\cos v,\,a\cos u\sin v,\,a\ctg u\cos u},\quad \vec{r}_v = (-a\sin u\sin v,\,a\sin u\cos v, 0),\\
				g_{11} = \langle\vec{r}_u, \vec{r}_u\rangle = a^2\cos^2u\big(\underbrace{(\cos^2v + \sin^2v)}_1 + \ctg^2u\big) = a^2\cos^2u\underbrace{(1 + \ctg^2u)}_{1 / \sin^2u} = a^2\ctg^2u,\\
				g_{12} = \langle\vec{r}_v, \vec{r}_v\rangle = -\cancel{\frac{a^2}{4}\sin2u\sin2v} + \cancel{\frac{a^2}{4}\sin2u\sin2v} = 0,\\
				g_{22} = \langle\vec{r}_v, \vec{r}_v\rangle = a^2\sin^2u\underbrace{(\sin^2v + \sin^2v)}_1 = a^2\sin^2u.
			\end{gather*}
			Итак, пишем первую квадратичную форму:
			\[
				a^2\ctg^2u\,du^2 + a^2\sin^2u\,dv^2.
			\]
			\footnotetext{Выкладка: $\ds\br{\ln\tg\frac{u}{2}}^\prime = \frac{1}{\tg\frac{u}{2}} \cdot \frac{1}{\cos^2\frac{u}{2}} \cdot \frac{1}{2} = \frac{1}{2\sin\frac{u}{2}\cos\frac{u}{2}} = \frac{1}{\sin u}$.}
		\item Считаем частные производные, не забывая про формулы Френе:
			\[
				\vec{r}_s = \vec{v} + \lambda\dot{\vec{n}} = \vec{v} + \lambda(-k\vec{v} + \varkappa\vec{b}) = (1 - k\lambda)\vec{v} + \varkappa\lambda\vec{b},\quad \vec{r}_\lambda = \vec{n}.
			\]
			Вычисляем коэффициенты первой квадратичной формы:
			\begin{gather*}
				g_{11} = \langle\vec{r}_s, \vec{r}_s\rangle = (1 - k\lambda)^2 + \varkappa^2\lambda^2,\\
				g_{12} = \langle\vec{r}_s, \vec{r}_\lambda\rangle = 0,\\
				g_{22} = \langle\vec{r}_\lambda, \vec{r}_\lambda\rangle = 1.
			\end{gather*}
			Теперь пишем первую квадратичную форму:
			\[
				\big((1 - k\lambda)^2 + \varkappa^2\lambda^2\big)ds^2 + d\lambda^2.
			\]
	\end{enumerate}
\end{solution}

\begin{problem}
	Найти угол между линиями $v = u + 1$ и $v = 3 - u$ на поверхности $x = u\cos v$, $y = u\sin v$, $z = u^2$.
\end{problem}

\begin{solution}
	Для начала нужно найти первую квадратичную форму данной поверхности.
	\begin{gather*}
		\vec{r}_u = (\cos v, \sin v, 2u),\quad \vec{r}_v = (-u\sin v, u\cos v, 0),\\
		g_{11} = \langle\vec{r}_u, \vec{r}_u\rangle = \underbrace{\cos^2v + \sin^2v}_{1} {} + 4u^2 = 4u^2 + 1,\\
		g_{12} = \langle\vec{r}_u, \vec{r}_v\rangle = -\cancel{\frac{u}{2}\sin2v} + \cancel{\frac{u}{2}\sin2v} = 0,\\
		g_{22} = \langle\vec{r}_v, \vec{r}_v\rangle = u^2\underbrace{(\sin^2v + \cos^2v)}_{1} = u^2.
	\end{gather*}
	Получаем риманову метрику, заданную матрицей
	\[
		\G(u, v) =
		\begin{pmatrix}
			4u^2 + 1 & 0\\
			0 & u^2
		\end{pmatrix}.
	\]

	Данные в условии кривые пересекаются в единственной точке $(1, 2)$. Их вектора скорости в этой точке есть $(1, 1)$ и $(1, -1)$. Угол между кривыми находим по формуле
	\[
		\cos\angle(\vec{v}_1, \vec{v}_2) = \frac{\langle\vec{v}_1, \vec{v}_2\rangle_{\G(1, 2)}}{\sqrt{\langle\vec{v}_1, \vec{v}_1\rangle_{\G(1, 2)}} \cdot \sqrt{\langle\vec{v}_2, \vec{v}_2\rangle_{\G(1, 2)}}} = \frac{4}{\sqrt{6} \cdot \sqrt{6}} = \frac{2}{3}.
	\]
	Отсюда $\angle(\vec{v}_1, \vec{v}_2) = \arccos\frac{2}{3}$.
\end{solution}

\begin{definition}
	\textit{Площадью} области $U$ на поверхности $\vec{r} = \vec{r}(u, v)$ называется величина
	\[
		\sigma(U) \vcentcolon = \iint\limits_{U}\sqrt{g}\,dudv.
	\]
	Здесь область $U$ задана параметрически координатами $u$ и $v$, а
	\[
		g \vcentcolon = \det\G = g_{11}g_{22} - g_{12}^2 = EF - G^2.
	\]
\end{definition}

Это определение (как и определение длины кривой) принимается как данность. Мотивировка такого определения в том, что $\det\G$ --- это (ориентированная) площадь параллелограмма, натянутого на касательные вектора $\vec{r}_u$ и $\vec{r}_v$.

\begin{example}
	\begin{enumerate}[nolistsep, label=(\arabic*)]
		\item Если поверхность задана в параметрической форме $\vec{r} = \vec{r}(u, v)$ и $V$ --- такая область на плоскости $(u, v)$, что $\vec{r}(V) = U$, то
			\[
				\sigma(U) = \iint\limits_{V}\abs{\vec{r}_u \times \vec{r}_v}du\,dv.
			\]
		\item Если поверхность задана как график функции $z = f(x, y)$ и область $U$ проектируется на область $V$ на плоскости $(x, y)$, то
			\[
				\sigma(U) = \iint\limits_{V}\sqrt{1 + f_x^2 + f_y^2}dx\,dy.
			\]
		\item Если поверхность задана уравнением $F(x, y, z) = 0$, $F_z \ne 0$ в области $U$, которая проектируется на область $V$ на плоскости $(x, y)$. Тогда
			\[
				\sigma(U) = \iint\limits_{V}\frac{\abs{\nabla F}}{\abs{F_z}}\,dxdy.
			\]
	\end{enumerate}
\end{example}

% TODO: Написать про изометрии и конформные отображения + условия Коши-Римана!

